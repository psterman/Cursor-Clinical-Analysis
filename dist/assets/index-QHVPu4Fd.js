import{i as e}from"./sql.js-Bh3UTgnK.js";import{C as t,r as o}from"./chart.js-Dss0t15A.js";import{h as s}from"./html2canvas-BAqrGSTL.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const o of e)if("childList"===o.type)for(const e of o.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const n={"modelResponse.code":12,"modelResponse.codeBlock":11,"modelResponse.implementation":10,"modelResponse.suggestions":9,"modelResponse.changes":8,"modelResponse.diff":7,"modelResponse.fixes":6,"modelResponse.modifications":5,"modelResponse.codeAnalysis":4,"modelResponse.text":3,"modelResponse.richText":2,"modelResponse.content":1,"bubble.code":13,"bubble.codeBlock":12,"bubble.implementation":11,"bubble.text":10,"bubble.richText":9,"bubble.content":8,"bubble.message.text":7};class r{constructor(){this.db=null,this.SQL=null,this.chatData=[],this.stats={totalConversations:0,totalCodeChars:0,modelUsage:{},userMessages:0,aiMessages:0,hourlyActivity:new Array(24).fill(0),dailyActivity:{},topPrompts:{},qingCount:0,buCount:0,topChineseWords:{}}}async init(){const t=await e({locateFile:e=>"/sql-wasm.wasm"});this.SQL=t,console.log("[CursorParser] sql.js åˆå§‹åŒ–æˆåŠŸ")}async loadDatabase(e){this.SQL||await this.init();try{return this.db=new this.SQL.Database(new Uint8Array(e)),console.log("[CursorParser] æ•°æ®åº“åŠ è½½æˆåŠŸ"),!0}catch(t){throw console.error("[CursorParser] æ•°æ®åº“åŠ è½½å¤±è´¥:",t),t}}async scanDatabase(){if(!this.db)throw new Error("æ•°æ®åº“æœªåŠ è½½");this.chatData=[],this.resetStats();try{console.log("[CursorParser] å¼€å§‹æ‰«ææ•°æ®åº“..."),console.log("[CursorParser] å½“å‰æ•°æ®åº“è¡¨æ•°é‡:",this.db.exec("SELECT name FROM sqlite_master WHERE type='table'").length);const e="\n         SELECT value FROM itemTable\n         WHERE [key] = 'workbench.panel.aichat.view.aichat.chatdata'\n       ";console.log("[CursorParser] æ‰§è¡Œ chatdata æŸ¥è¯¢..."),this.extractFromQuery(e,"json");const t="\n         SELECT value FROM itemTable\n         WHERE [key] = 'composer.composerState'\n       ";console.log("[CursorParser] æ‰§è¡Œ composerState æŸ¥è¯¢..."),this.extractFromQuery(t,"json");const o="\n         SELECT value FROM itemTable\n         WHERE value LIKE '%\"text\":%'\n       ";return console.log("[CursorParser] æ‰§è¡Œ text æŸ¥è¯¢..."),this.extractFromQuery(o,"regex"),console.log("[CursorParser] æå–å®Œæˆï¼Œå…±",this.chatData.length,"æ¡è®°å½•"),console.log("[CursorParser] =========== ç»Ÿè®¡æ‘˜è¦ ========="),console.log("[CursorParser] æ€»å¯¹è¯æ¬¡æ•°:",this.stats.totalConversations),console.log("[CursorParser] ç”¨æˆ·æ¶ˆæ¯:",this.stats.userMessages),console.log("[CursorParser] AI æ¶ˆæ¯:",this.stats.aiMessages),console.log("[CursorParser] ä»£ç å­—ç¬¦æ•°:",this.stats.totalCodeChars),console.log("[CursorParser] æ¨¡å‹ä½¿ç”¨:",this.stats.modelUsage),console.log("[CursorParser] æ—¶æ®µç»Ÿè®¡:",this.stats.hourlyActivity.filter(e=>e>0)),console.log("[CursorParser] æç¤ºè¯æ•°é‡:",Object.keys(this.stats.topPrompts).length),console.log("[CursorParser] ======================================"),this.chatData}catch(e){throw console.error("[CursorParser] æ‰«ææ•°æ®åº“å¤±è´¥:",e),e}}appendData(e){const t=this.chatData.length;e.forEach((e,o)=>{this.chatData.push({id:t+o+1,text:e.text,role:e.role,source:e.source,length:e.text.length,timestamp:e.timestamp||(new Date).toISOString(),model:e.model||"unknown"})}),console.log(`[CursorParser] å¢é‡æ·»åŠ  ${e.length} æ¡è®°å½•ï¼Œæ€»æ•°: ${this.chatData.length}`)}extractFromQuery(e,t){const o=this.db.exec(e);if(0===o.length)return;const s=o[0].values;console.log(`[CursorParser] ${t} æŸ¥è¯¢è¿”å› ${s.length} è¡Œ`);const n=new Set;s.forEach(([e],o)=>{try{let o=[],s="";"json"===t?(o=this.extractFromJSON(e),s=t):"regex"===t&&(o=this.extractFromRegex(e),s="regex"),o.forEach(e=>{if(!e||e.text.length<5)return;const t=e.text;n.has(t)||(n.add(t),this.chatData.push({id:this.chatData.length+1,text:e.text,role:e.role,source:s,length:e.text.length,timestamp:e.timestamp||(new Date).toISOString(),model:e.model||"unknown"}),this.updateStats(e))})}catch(s){console.warn(`[CursorParser] æå–ç¬¬ ${o+1} è¡Œå¤±è´¥:`,s.message)}})}extractFromJSON(e){const t=[];try{const o=JSON.parse(e);o.tabs&&Array.isArray(o.tabs)&&o.tabs.forEach(e=>{e.bubbles&&Array.isArray(e.bubbles)&&e.bubbles.forEach(e=>{const o=this.extractBubbleText(e);o&&o.text&&t.push(o)})}),o.bubbles&&Array.isArray(o.bubbles)&&o.bubbles.forEach(e=>{const o=this.extractBubbleText(e);o&&o.text&&t.push(o)})}catch(o){}return t}extractBubbleText(e,t=0,o=6){if(!e||t>o)return null;const s=[],r=this.extractByPriority(e,n,{});if(r){const t=this.determineRole(e),o=this.extractModel(e);s.push({text:r,role:t,model:o,timestamp:this.extractTimestamp(e)})}else for(const n in e)if(e[n]&&"object"==typeof e[n]){const r=this.extractBubbleText(e[n],t+1,o);r&&s.push(r)}return s[0]||null}extractByPriority(e,t,o){if(!e||"object"!=typeof e)return null;let s=null,n=0,r="";for(const[a,l]of Object.entries(t)){const t=this.getNestedValue(e,a);t&&"string"==typeof t&&t.length>5&&l>n&&(s=t,n=l,r=a,o[a]=(o[a]||0)+1)}return s&&console.log(`[CursorParser] ä» ${r} æå–æ–‡æœ¬ï¼Œä¼˜å…ˆçº§: ${n}`),s}getNestedValue(e,t){const o=t.split(".");let s=e;for(const n of o){if(!s||"object"!=typeof s||!(n in s))return null;s=s[n]}return s}determineRole(e){if(console.log("[CursorParser] å°è¯•ç¡®å®šè§’è‰²..."),"user"===e.type)return console.log("[CursorParser] é€šè¿‡ type å­—æ®µç¡®å®šä¸º USER"),"USER";if("ai"===e.type)return console.log("[CursorParser] é€šè¿‡ type å­—æ®µç¡®å®šä¸º AI"),"AI";if(4===e.commandType)return console.log("[CursorParser] é€šè¿‡ commandType å­—æ®µç¡®å®šä¸º USER"),"USER";if(e.userMessage||e.userPrompt||e.question)return console.log("[CursorParser] é€šè¿‡ç‰¹å¾å­—æ®µç¡®å®šä¸º USER"),"USER";if(e.modelResponse||e.suggestions||e.aiMessage)return console.log("[CursorParser] é€šè¿‡ç‰¹å¾å­—æ®µç¡®å®šä¸º AI"),"AI";if("user"===e.role||"USER"===e.role)return console.log("[CursorParser] é€šè¿‡ role å­—æ®µç¡®å®šä¸º USER"),"USER";if("assistant"===e.role||"assistant"===e.role||"AI"===e.role)return console.log("[CursorParser] é€šè¿‡ role å­—æ®µç¡®å®šä¸º AI"),"AI";if("user"===e.sender||"USER"===e.sender)return console.log("[CursorParser] é€šè¿‡ sender å­—æ®µç¡®å®šä¸º USER"),"USER";if(e.message||e.text){const t=(e.message||e.text).toLowerCase();if(t.startsWith("è¯·")||t.startsWith("å¸®æˆ‘")||t.startsWith("å¸®æˆ‘")||t.startsWith("å†™ä¸€ä¸ª")||t.startsWith("å®ç°"))return console.log("[CursorParser] é€šè¿‡å†…å®¹ç‰¹å¾ç¡®å®šä¸º USER"),"USER";if(t.startsWith("å¥½çš„")||t.startsWith("å½“ç„¶")||t.startsWith("æˆ‘ä¼š")||t.startsWith("å¥½çš„ï¼Œ")||t.startsWith("è®©æˆ‘"))return console.log("[CursorParser] é€šè¿‡å†…å®¹ç‰¹å¾ç¡®å®šä¸º AI"),"AI"}return console.log("[CursorParser] æ— æ³•ç¡®å®šè§’è‰²ï¼Œé»˜è®¤ä¸º AI"),"AI"}extractModel(e){const t=["model","modelResponse.model","aiModel","response.model","completion.model"];for(const o of t){const t=this.getNestedValue(e,o);if(t&&"string"==typeof t){return t.split("-")[0]}}return"unknown"}extractTimestamp(e){const t=["timestamp","createdAt","created","time","updatedAt","updatedAt","messageTime","sentAt","bubbleTime","userTime","aiTime"];console.log("[CursorParser] å°è¯•æå–æ—¶é—´æˆ³...");for(const s of t){const t=this.getNestedValue(e,s);if(t)try{const e=new Date(t);if(!isNaN(e.getTime()))return console.log(`[CursorParser] ä» ${s} æå–æ—¶é—´æˆ³: ${e.toISOString()}`),e.toISOString()}catch(o){console.warn(`[CursorParser] æ—¶é—´æˆ³å­—æ®µ ${s} è§£æå¤±è´¥:`,o)}}return console.warn("[CursorParser] æœªæ‰¾åˆ°æ—¶é—´æˆ³ï¼Œä½¿ç”¨å½“å‰æ—¶é—´"),(new Date).toISOString()}extractFromRegex(e){console.log("[CursorParser] å¼€å§‹æ­£åˆ™è¡¨è¾¾å¼æå–...");const t=[];let o=0;return[/"text":\s*"([^"]+)"/g,/"code":\s*"([^"]+)"/g,/"implementation":\s*"([^"]+)"/g,/"content":\s*"([^"]+)"/g].forEach(s=>{let n;for(;null!==(n=s.exec(e));){o++;const s=n[1];if(s&&s.length>=5){const o=this.inferRoleFromContext(e,n.index,s),r=this.inferModelFromContext(e,n.index),a=this.inferTimestampFromContext(e,n.index);t.push({text:s,role:o,model:r,timestamp:a})}}}),console.log(`[CursorParser] æ­£åˆ™æå–å®Œæˆï¼Œæ‰¾åˆ° ${o} ä¸ªæ–‡æœ¬ï¼Œæå–åˆ° ${t.length} æ¡è®°å½•`),console.log("[CursorParser] æå–ç»“æœç»Ÿè®¡:",{USER:t.filter(e=>"USER"===e.role).length,AI:t.filter(e=>"AI"===e.role).length,unknown:t.filter(e=>"unknown"===e.role).length}),t}inferRoleFromContext(e,t,o){const s=Math.max(0,t-500),n=Math.min(e.length,t+500),r=e.substring(s,n);let a=0,l=0;if([/"type"\s*:\s*"user"/i,/"role"\s*:\s*"user"/i,/"commandType"\s*:\s*4/,/"userMessage"/i,/"userPrompt"/i,/"question"/i].forEach(e=>{e.test(r)&&a++}),[/"type"\s*:\s*"ai"/i,/"role"\s*:\s*"assistant"/i,/"role"\s*:\s*"ai"/i,/"modelResponse"/i,/"suggestions"/i,/"aiMessage"/i].forEach(e=>{e.test(r)&&l++}),a>l)return"USER";if(l>a)return"AI";const i=o.toLowerCase();return i.startsWith("è¯·")||i.startsWith("å¸®æˆ‘")||i.startsWith("å¸®æˆ‘")?"USER":(i.startsWith("å¥½çš„")||i.startsWith("å½“ç„¶")||i.startsWith("æˆ‘ä¼š")||i.startsWith("è®©æˆ‘"),"AI")}inferModelFromContext(e,t){const o=Math.max(0,t-300),s=Math.min(e.length,t+300),n=e.substring(o,s),r=[/"model"\s*:\s*"([^"]+)"/i,/"aiModel"\s*:\s*"([^"]+)"/i,/"response\.model"\s*:\s*"([^"]+)"/i,/"completion\.model"\s*:\s*"([^"]+)"/i];for(const a of r){const e=a.exec(n);if(e&&e[1]){const t=e[1].split("-")[0];return console.log(`[CursorParser] ä»ä¸Šä¸‹æ–‡æ¨æ–­æ¨¡å‹: ${t}`),t}}return"unknown"}inferTimestampFromContext(e,t){const o=Math.max(0,t-200),s=Math.min(e.length,t+200),n=e.substring(o,s),r=[/"timestamp"\s*:\s*"([^"]+)"/i,/"createdAt"\s*:\s*"([^"]+)"/i,/"created"\s*:\s*"([^"]+)"/i,/"time"\s*:\s*"([^"]+)"/i,/"updatedAt"\s*:\s*"([^"]+)"/i];for(const l of r){const e=l.exec(n);if(e&&e[1])try{const t=new Date(e[1]);if(!isNaN(t.getTime()))return console.log(`[CursorParser] ä»ä¸Šä¸‹æ–‡æ¨æ–­æ—¶é—´æˆ³: ${t.toISOString()}`),t.toISOString()}catch(a){console.warn("[CursorParser] æ—¶é—´æˆ³è§£æå¤±è´¥:",a)}}return console.warn("[CursorParser] ä¸Šä¸‹æ–‡ä¸­æœªæ‰¾åˆ°æ—¶é—´æˆ³ï¼Œä½¿ç”¨å½“å‰æ—¶é—´"),(new Date).toISOString()}updateStats(e){var t,o;if(console.log("[CursorParser] ğŸ“Š æ›´æ–°ç»Ÿè®¡ï¼Œitem:",{role:e.role,textLength:null==(t=e.text)?void 0:t.length,hasTimestamp:!!e.timestamp,model:e.model,first50Chars:null==(o=e.text)?void 0:o.substring(0,50)}),e.text&&e.text.length>0){const t=e.text,o=(this.stats.totalConversations||0)+1,s=t.match(/è¯·/g);s&&s.length>0?(this.stats.qingCount=(this.stats.qingCount||0)+s.length,console.log(`[CursorParser] âœ… [${e.role}] "è¯·"å­— +${s.length} æ¬¡ï¼Œæ€»è®¡: ${this.stats.qingCount} | æ–‡æœ¬: "${t.substring(0,50)}..."`)):o<10&&console.log(`[CursorParser] â„¹ï¸ [${e.role}] "è¯·"å­—æœªåŒ¹é… | æ–‡æœ¬: "${t.substring(0,60)}..."`);const n=t.match(/ä¸/g);n&&n.length>0?(this.stats.buCount=(this.stats.buCount||0)+n.length,console.log(`[CursorParser] âœ… [${e.role}] "ä¸"å­— +${n.length} æ¬¡ï¼Œæ€»è®¡: ${this.stats.buCount} | æ–‡æœ¬: "${t.substring(0,50)}..."`)):o<10&&console.log(`[CursorParser] â„¹ï¸ [${e.role}] "ä¸"å­—æœªåŒ¹é… | æ–‡æœ¬: "${t.substring(0,60)}..."`)}if(this.stats.totalConversations++,"USER"===e.role?(this.stats.userMessages++,console.log("[CursorParser] ç”¨æˆ·æ¶ˆæ¯æ•°é‡:",this.stats.userMessages)):(this.stats.aiMessages++,console.log("[CursorParser] AI æ¶ˆæ¯æ•°é‡:",this.stats.aiMessages)),console.log("[CursorParser] æ€»å¯¹è¯æ¬¡æ•°:",this.stats.totalConversations),e.text&&e.text.length>0){const t=[/\b(function|class|const|let|var|if|else|for|while|do|switch|case|break|continue|return|import|export|from|async|await|yield|try|catch|finally|throw|new|this)\b/i,/\b(public|private|protected|static|final|abstract|interface|extends|implements|super)\b/i,/\b(def |class |import |from |if |elif |else |for |while |try |except |finally |return |yield |with |as |lambda |pass |break |continue )/,/\b(public|private|protected|static|final|synchronized|volatile|transient|native|interface|abstract|extends|implements)\b.*\{/,/\b#include\b|#define\b|#ifdef\b|#endif\b|#pragma\b/,/\b(func |type |import |package |go |chan |defer |range |select )/,/\b(fn |let |mut |impl |struct |enum |trait |use |mod |crate |pub )/,/\{[\s\S]*\}/,/\[[^\]]*\]\s*=/,/=>/,/\.\s*[a-zA-Z_]\w*\s*\(/];let o=0;for(const n of t){e.text.match(n)&&o++}const s=["function","class ","def ","def\n","func ","import ","#include","@interface","@implementation","#define","@property","public function","private function","static function"];for(const n of s)if(e.text.includes(n)){o+=2;break}if(o>=5){const t=e.text.length;this.stats.totalCodeChars+=t,console.log(`[CursorParser] âœ… ä»£ç è¯†åˆ«æˆåŠŸï¼Œä»£ç å­—ç¬¦æ•° +${t}, ä»£ç ç‰¹å¾=${o}, æ€»è®¡: ${this.stats.totalCodeChars}`)}else console.log(`[CursorParser] âŒ æœªè¯†åˆ«ä¸ºä»£ç ï¼Œä»£ç ç‰¹å¾=${o} (éœ€è¦â‰¥5)`)}const s=e.model||"unknown";if(this.stats.modelUsage[s]=(this.stats.modelUsage[s]||0)+1,console.log(`[CursorParser] æ¨¡å‹ä½¿ç”¨: ${s} = ${this.stats.modelUsage[s]}`),e.timestamp)try{const t=new Date(e.timestamp).getHours();this.stats.hourlyActivity[t]++,console.log(`[CursorParser] æ—¶æ®µç»Ÿè®¡: ${t}:00 = ${this.stats.hourlyActivity[t]}`)}catch(n){console.error("[CursorParser] æ—¶æ®µç»Ÿè®¡å¤±è´¥:",n)}else console.warn("[CursorParser] ç¼ºå°‘æ—¶é—´æˆ³ï¼Œæ— æ³•ç»Ÿè®¡æ—¶æ®µ");if(e.timestamp)try{const t=new Date(e.timestamp).toISOString().split("T")[0];this.stats.dailyActivity[t]=(this.stats.dailyActivity[t]||0)+1}catch(n){console.error("[CursorParser] æ—¥æœŸç»Ÿè®¡å¤±è´¥:",n)}"USER"===e.role&&e.text?this.extractWords(e.text):"USER"!==e.role&&console.log("[CursorParser] è·³è¿‡æç¤ºè¯ç»Ÿè®¡ï¼ˆéç”¨æˆ·æ¶ˆæ¯ï¼‰"),"USER"===e.role&&e.text&&this.extractChineseWords(e.text)}extractWords(e){console.log(`[CursorParser] å¼€å§‹æå–å•è¯ï¼Œæ–‡æœ¬é•¿åº¦: ${e.length}`);const t=new Set(["çš„","æ˜¯","åœ¨","äº†","æˆ‘","ä½ ","ä»–","å¥¹","å®ƒ","æˆ‘ä»¬","ä½ ä»¬","ä»–ä»¬","å’Œ","æˆ–","ä½†æ˜¯","å› ä¸º","æ‰€ä»¥","å¦‚æœ","å°±","ä¹Ÿ","éƒ½","å¾ˆ","éå¸¸","å¯ä»¥","èƒ½","ä¼š","è¦","æœ‰","æ²¡","ä¸","æ¥","å»","è¿™","é‚£","ä¸ª","è¯·","å¸®","å†™","ä¸€ä¸ª","æ€ä¹ˆ","å¦‚ä½•","ä»€ä¹ˆ","å“ªä¸ª","å“ªä¸ª","å—","å‘¢","å§","å•Š","å“¦","å—¯","å“ˆ","å˜¿","å¥½","the","a","an","is","are","was","were","be","been","being","have","has","had","do","does","did","will","would","could","should","to","of","in","for","on","at","by","with","from","as","into","through","during","before","after","above","below","between","i","you","your","he","she","it","we","they","this","that","my","his","her","its","our","your","their","mine","theirs","am","is","are","was","were","be","been","being","have","has","had","can","could","will","would","should","may","might","must","please","help","write","a","one","some","any","all","both","how","what","which","who","when","where","why","whether","yes","no","not","just","only","also","too","very","really","okay","ok","right","left","up","down","back","front","forward"]),o=e.match(/[\u4e00-\u9fa5]+|[a-zA-Z0-9]+/g)||[];console.log(`[CursorParser] æå–åˆ° ${o.length} ä¸ªå•è¯/è¯ç»„`),o.forEach(e=>{if(e.length<2)return;if(e.length>20)return;const o=e.toLowerCase();t.has(o)||(this.stats.topPrompts[o]=(this.stats.topPrompts[o]||0)+1)});const s=Object.keys(this.stats.topPrompts).length;console.log(`[CursorParser] æç¤ºè¯ç»Ÿè®¡ï¼š${s} ä¸ªå”¯ä¸€è¯ï¼Œ${o.length} ä¸ªæ€»è¯`)}extractChineseWords(e){const t=(this.stats.userMessages||0)+(this.stats.aiMessages||0);t<10&&(console.log(`[CursorParser] ğŸ” å¼€å§‹æå–æ±‰å­—è¯ç»„ï¼ˆç¬¬${t+1}æ¡ï¼‰ï¼Œæ–‡æœ¬é•¿åº¦: ${e.length}`),console.log(`[CursorParser] ğŸ” æ–‡æœ¬é¢„è§ˆ: "${e.substring(0,80)}..."`));const o=new Set(["çš„","äº†","æ˜¯","åœ¨","æˆ‘","ä½ ","ä»–","å¥¹","å®ƒ","æˆ‘ä»¬","ä½ ä»¬","ä»–ä»¬","å’Œ","æˆ–","ä½†æ˜¯","å› ä¸º","æ‰€ä»¥","å¦‚æœ","å°±","ä¹Ÿ","éƒ½","å¾ˆ","éå¸¸","å¯ä»¥","èƒ½","ä¼š","è¦","æœ‰","æ²¡","æ¥","å»","è¿™","é‚£","ä¸ª","å¸®","å†™","ä¸€ä¸ª","æ€ä¹ˆ","å¦‚ä½•","ä»€ä¹ˆ","å“ªä¸ª","å—","å‘¢","å§","å•Š","å“¦","å—¯","å“ˆ","å˜¿","å¥½"]),s=e.match(/[\u4e00-\u9fa5]{2,}/g)||[];t<10&&(console.log(`[CursorParser] âœ… æå–åˆ° ${s.length} ä¸ªæ±‰å­—è¯ç»„`),s.length>0&&console.log("[CursorParser] æ±‰å­—è¯ç»„ç¤ºä¾‹:",s.slice(0,5)));let n=0;if(s.forEach(e=>{if(e.length>10)return;const t=e.trim();o.has(t)||(this.stats.topChineseWords=this.stats.topChineseWords||{},this.stats.topChineseWords[t]=(this.stats.topChineseWords[t]||0)+1,n++)}),t<10||n>0){const e=Object.keys(this.stats.topChineseWords||{}).length;console.log(`[CursorParser] ğŸ“Š æ±‰å­—è¯ç»„ç»Ÿè®¡ï¼š${e} ä¸ªå”¯ä¸€è¯ç»„ï¼Œæœ¬æ¬¡æ·»åŠ  ${n} ä¸ª`)}}resetStats(){this.stats={totalConversations:0,totalCodeChars:0,modelUsage:{},userMessages:0,aiMessages:0,hourlyActivity:new Array(24).fill(0),dailyActivity:{},topPrompts:{},qingCount:0,buCount:0,topChineseWords:{}},console.log("[CursorParser] ğŸ”„ ç»Ÿè®¡å·²é‡ç½®:",this.stats)}getAllData(){return this.chatData}getStats(){return console.log("[CursorParser] ğŸ“Š ===== æœ€ç»ˆç»Ÿè®¡ç»“æœ ====="),console.log('[CursorParser] ğŸ“Š "è¯·"å­—å‡ºç°æ¬¡æ•°:',this.stats.qingCount||0),console.log('[CursorParser] ğŸ“Š "ä¸"å­—å‡ºç°æ¬¡æ•°:',this.stats.buCount||0),console.log("[CursorParser] ğŸ“Š æ€»å¯¹è¯æ¬¡æ•°:",this.stats.totalConversations),console.log("[CursorParser] ğŸ“Š ç”¨æˆ·æ¶ˆæ¯:",this.stats.userMessages),console.log("[CursorParser] ğŸ“Š AI æ¶ˆæ¯:",this.stats.aiMessages),console.log("[CursorParser] ğŸ“Š æ±‰å­—è¯ç»„æ•°é‡:",Object.keys(this.stats.topChineseWords||{}).length),console.log("[CursorParser] ğŸ“Š ========================="),{...this.stats,topChineseWordsList:this.getTopChineseWords(10)}}getMostUsedModel(){const e=Object.entries(this.stats.modelUsage);if(0===e.length)return"unknown";const[t,o]=e.sort((e,t)=>t[1]-e[1])[0];return{model:t,count:o}}getTopPrompts(e=5){return Object.entries(this.stats.topPrompts).sort((e,t)=>t[1]-e[1]).slice(0,e).map(([e,t])=>({prompt:e,count:t}))}getTopChineseWords(e=10){return Object.entries(this.stats.topChineseWords).sort((e,t)=>t[1]-e[1]).slice(0,e).map(([e,t])=>({word:e,count:t}))}formatDailyActivity(){return Object.entries(this.stats.dailyActivity).sort((e,t)=>e[0].localeCompare(t[0])).map(([e,t])=>({date:e,count:t}))}search(e){if(!e)return this.chatData;const t=e.toLowerCase();return this.chatData.filter(e=>e.text.toLowerCase().includes(t))}close(){this.db&&(this.db.close(),this.db=null)}}t.register(...o);let a=null,l=[],i=null;const c={uploadSection:document.getElementById("uploadSection"),loadingSection:document.getElementById("loadingSection"),dashboardSection:document.getElementById("dashboardSection"),uploadBtn:document.getElementById("uploadBtn"),selectFolderBtn:document.getElementById("selectFolderBtn"),folderInput:document.getElementById("folderInput"),fileInput:document.getElementById("fileInput"),exportBtn:document.getElementById("exportBtn"),selectFileBtn:document.getElementById("selectFileBtn"),uploadError:document.getElementById("uploadError"),loadingProgress:document.getElementById("loadingProgress"),exportArea:document.getElementById("exportArea"),searchInput:document.getElementById("searchInput"),chatList:document.getElementById("chatList")},u={totalConversations:document.getElementById("totalConversations"),totalCodeChars:document.getElementById("totalCodeChars"),userMessages:document.getElementById("userMessages"),qingCount:document.getElementById("qingCount"),buCount:document.getElementById("buCount"),topChineseWordsList:document.getElementById("topChineseWordsList")};async function d(){console.log("[Main] ===== åº”ç”¨åˆå§‹åŒ–å¼€å§‹ ====="),console.log("[Main] å½“å‰æ—¶é—´:",(new Date).toISOString()),"loading"===document.readyState&&(console.log("[Main] ç­‰å¾… DOM åŠ è½½..."),await new Promise(e=>{document.addEventListener("DOMContentLoaded",e)})),console.log("[Main] DOM å·²å°±ç»ªï¼Œå¼€å§‹è·å–å…ƒç´ ..."),c.uploadSection=document.getElementById("uploadSection"),c.loadingSection=document.getElementById("loadingSection"),c.dashboardSection=document.getElementById("dashboardSection"),c.uploadBtn=document.getElementById("uploadBtn"),c.selectFolderBtn=document.getElementById("selectFolderBtn"),c.folderInput=document.getElementById("folderInput"),c.fileInput=document.getElementById("fileInput"),c.exportBtn=document.getElementById("exportBtn"),c.selectFileBtn=document.getElementById("selectFileBtn"),c.uploadError=document.getElementById("uploadError"),c.loadingProgress=document.getElementById("loadingProgress"),c.exportArea=document.getElementById("exportArea"),c.searchInput=document.getElementById("searchInput"),c.chatList=document.getElementById("chatList"),console.log("[Main] åˆå§‹åŒ– CursorParser..."),a=new r,await a.init(),console.log("[Main] CursorParser åˆå§‹åŒ–å®Œæˆ"),function(){console.log("[Main] å¼€å§‹ç»‘å®šäº‹ä»¶..."),c.uploadBtn?(console.log("[Main] âœ… uploadBtn å…ƒç´ å·²æ‰¾åˆ°"),c.uploadBtn.addEventListener("click",e=>{console.log("[Main] ç‚¹å‡»ä¸Šä¼ æŒ‰é’®"),e.preventDefault(),g(c.folderInput)})):console.error("[Main] âŒ uploadBtn å…ƒç´ æœªæ‰¾åˆ°");c.selectFolderBtn?(console.log("[Main] âœ… selectFolderBtn å…ƒç´ å·²æ‰¾åˆ°"),c.selectFolderBtn.addEventListener("click",e=>{console.log("[Main] ç‚¹å‡»é€‰æ‹©æ–‡ä»¶å¤¹æŒ‰é’®"),e.preventDefault(),g(c.folderInput)})):console.error("[Main] âŒ selectFolderBtn å…ƒç´ æœªæ‰¾åˆ°");c.selectFileBtn?(console.log("[Main] âœ… selectFileBtn å…ƒç´ å·²æ‰¾åˆ°"),c.selectFileBtn.addEventListener("click",e=>{console.log("[Main] ç‚¹å‡»é€‰æ‹©æ–‡ä»¶æŒ‰é’®"),e.preventDefault(),g(c.fileInput)})):console.error("[Main] âŒ selectFileBtn å…ƒç´ æœªæ‰¾åˆ°");c.folderInput?(console.log("[Main] âœ… folderInput å…ƒç´ å·²æ‰¾åˆ°"),c.folderInput.addEventListener("change",e=>{console.log("[Main] æ–‡ä»¶å¤¹é€‰æ‹©äº‹ä»¶è§¦å‘"),h(e,"folder")})):console.error("[Main] âŒ folderInput å…ƒç´ æœªæ‰¾åˆ°");c.fileInput?(console.log("[Main] âœ… fileInput å…ƒç´ å·²æ‰¾åˆ°"),c.fileInput.addEventListener("change",e=>{console.log("[Main] æ–‡ä»¶é€‰æ‹©äº‹ä»¶è§¦å‘"),h(e,"file")})):console.error("[Main] âŒ fileInput å…ƒç´ æœªæ‰¾åˆ°");c.searchInput&&c.searchInput.addEventListener("input",function(e,t){let o;return function(...s){const n=()=>{clearTimeout(o),e(...s)};clearTimeout(o),o=setTimeout(n,t)}}(y,300));c.exportBtn&&c.exportBtn.addEventListener("click",M);console.log("[Main] äº‹ä»¶ç»‘å®šå®Œæˆ")}(),console.log("[Main] ===== åº”ç”¨åˆå§‹åŒ–å®Œæˆ =====")}function g(e){if(console.log("[Main] å°è¯•è§¦å‘æ–‡ä»¶é€‰æ‹©..."),console.log("[Main] inputElement:",e),console.log("[Main] inputElement.type:",null==e?void 0:e.type),e)try{e.value="",e.click(),console.log("[Main] âœ… æ–‡ä»¶é€‰æ‹©å·²è§¦å‘")}catch(t){console.error("[Main] âŒ è§¦å‘æ–‡ä»¶é€‰æ‹©å¤±è´¥:",t),alert("æ— æ³•æ‰“å¼€æ–‡ä»¶é€‰æ‹©å¯¹è¯æ¡†ï¼Œè¯·æ£€æŸ¥æµè§ˆå™¨è®¾ç½®æˆ–åˆ·æ–°é¡µé¢é‡è¯•ã€‚")}else console.error("[Main] âŒ inputElement ä¸º null")}async function h(e,t){var o;console.log(`[Main] å¤„ç†æ–‡ä»¶ä¸Šä¼ ï¼Œç±»å‹: ${t}`),console.log(`[Main] event.files.length: ${null==(o=e.target.files)?void 0:o.length}`);const s=Array.from(e.target.files||[]);if(c.uploadError.classList.add("hidden"),c.uploadError.textContent="",0!==s.length){console.log(`[Main] é€‰æ‹©äº† ${s.length} ä¸ªæ–‡ä»¶`),console.log("[Main] æ–‡ä»¶åˆ—è¡¨:"),s.forEach((e,t)=>{console.log(`  [${t+1}] ${e.name} (${function(e){if(0===e)return"0 B";const t=1024,o=["B","KB","MB","GB"],s=Math.floor(Math.log(e)/Math.log(t));return Math.round(e/Math.pow(t,s)*100)/100+" "+o[s]}(e.size)})`)}),console.log("[Main] æ˜¾ç¤ºåŠ è½½çŠ¶æ€..."),c.uploadSection.classList.add("hidden"),c.loadingSection.classList.remove("hidden"),c.dashboardSection.classList.add("hidden"),console.log("[Main] âœ… åŠ è½½çŠ¶æ€å·²æ˜¾ç¤º");try{let e=[],o=[];if("folder"===t){if(e=s.filter(e=>"state.vscdb"===e.name),o=s.filter(e=>"state.vscdb"!==e.name),console.log(`[Main] æ–‡ä»¶å¤¹æ¨¡å¼ï¼šæ‰¾åˆ° ${e.length} ä¸ª state.vscdb æ–‡ä»¶`),o.length>0&&(console.log(`[Main] å·²è¿‡æ»¤ ${o.length} ä¸ªéæ•°æ®åº“æ–‡ä»¶`),o.length<=10&&console.log("[Main] è¿‡æ»¤çš„æ–‡ä»¶:",o.map(e=>e.name))),0===e.length){const e=o.slice(0,5).map(e=>e.name).join(", "),t=0===o.length?"æœªæ‰¾åˆ° state.vscdb æ–‡ä»¶ï¼Œè¯·é€‰æ‹©æ­£ç¡®çš„ Cursor workspaceStorage ç›®å½•":`æœªæ‰¾åˆ° state.vscdb æ–‡ä»¶ã€‚é€‰ä¸­çš„æ–‡ä»¶åŒ…æ‹¬ï¼š${e}${o.length>5?"...":""}`;throw new Error(t)}}else{const t=[".vscdb",".db",".sqlite",".sqlite3"];if(e=s.filter(e=>t.some(t=>e.name.toLowerCase().endsWith(t))),o=s.filter(e=>!t.some(t=>e.name.toLowerCase().endsWith(t))),console.log(`[Main] å•æ–‡ä»¶æ¨¡å¼ï¼šæ‰¾åˆ° ${e.length} ä¸ªæ•°æ®åº“æ–‡ä»¶`),o.length>0&&(console.log(`[Main] å·²è¿‡æ»¤ ${o.length} ä¸ªéæ•°æ®åº“æ–‡ä»¶`),console.log("[Main] è¿‡æ»¤çš„æ–‡ä»¶:",o.map(e=>e.name))),0===e.length){const e=o.slice(0,3).map(e=>e.name).join(", "),t=0===o.length?"æœªæ‰¾åˆ°æœ‰æ•ˆçš„æ•°æ®åº“æ–‡ä»¶ï¼ˆ.vscdb, .db, .sqlite, .sqlite3ï¼‰":`æœªæ‰¾åˆ°æœ‰æ•ˆçš„æ•°æ®åº“æ–‡ä»¶ã€‚é€‰æ‹©çš„æ˜¯ï¼š${e}${o.length>3?"...":""}ï¼Œè¯·é€‰æ‹©æ•°æ®åº“æ–‡ä»¶`;throw new Error(t)}}i={totalConversations:0,totalCodeChars:0,modelUsage:{},userMessages:0,aiMessages:0,hourlyActivity:new Array(24).fill(0),dailyActivity:{},topPrompts:{},qingCount:0,buCount:0,topChineseWords:{}},l=[];let n=0;for(const t of e)try{console.log(`[Main] æ­£åœ¨å¤„ç†: ${t.name}`),t.webkitRelativePath&&console.log(`[Main] ç›¸å¯¹è·¯å¾„: ${t.webkitRelativePath}`);const o=await t.arrayBuffer();console.log(`[Main] æ–‡ä»¶å¤§å°: ${o.byteLength} bytes`),await a.loadDatabase(o);const s=await a.scanDatabase();console.log(`[Main] æå–åˆ° ${s.length} æ¡è®°å½•`),l=l.concat(s),m(i,a.stats),n++,p(n,e.length),console.log("[Main] å½“å‰ç»Ÿè®¡:",{totalConversations:i.totalConversations,userMessages:i.userMessages,aiMessages:i.aiMessages,topPromptsCount:Object.keys(i.topPrompts).length})}catch(r){console.error(`[Main] å¤„ç†æ–‡ä»¶å¤±è´¥: ${t.name}`,r)}if(console.log(`[Main] æ€»å…±æå– ${l.length} æ¡å¯¹è¯è®°å½•`),0===l.length)throw new Error("æœªæ‰¾åˆ°ä»»ä½•å¯¹è¯æ•°æ®ï¼Œè¯·æ£€æŸ¥æ•°æ®åº“æ–‡ä»¶æ˜¯å¦æ­£ç¡®");console.log("[Main] æ˜¾ç¤ºåˆ†æç»“æœ..."),c.uploadSection.classList.add("hidden"),c.loadingSection.classList.add("hidden"),c.dashboardSection.classList.remove("hidden"),console.log("[Main] âœ… åˆ†æç»“æœå·²æ˜¾ç¤º"),function(){var e;console.log("[Main] å¼€å§‹æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯...");try{const t={totalConversations:i.totalConversations,totalCodeChars:i.totalCodeChars,modelUsage:i.modelUsage,userMessages:i.userMessages,qingCount:i.qingCount||0,buCount:i.buCount||0,topChineseWordsList:C(i.topChineseWords,10)};console.log("[Main] ç»Ÿè®¡æ•°æ®:",{totalConversations:t.totalConversations,totalCodeChars:t.totalCodeChars,userMessages:t.userMessages,qingCount:t.qingCount,buCount:t.buCount,topChineseWordsList:(null==(e=t.topChineseWordsList)?void 0:e.length)||0}),console.log('[Main] âœ… "è¯·"å­—æ¬¡æ•°:',t.qingCount),console.log('[Main] âœ… "ä¸"å­—æ¬¡æ•°:',t.buCount),u.totalConversations.textContent=f(t.totalConversations),u.totalCodeChars.textContent=f(t.totalCodeChars),u.qingCount.textContent=f(t.qingCount),u.buCount.textContent=f(t.buCount),u.userMessages.textContent=f(t.userMessages),console.log("[Main] å¼€å§‹æ¸²æŸ“ç”¨æˆ·æé—®æœ€å¤šæ±‰å­—è¯ç»„..."),function(e){console.log("[Main] å¼€å§‹æ¸²æŸ“ç”¨æˆ·æé—®æœ€å¤šæ±‰å­—è¯ç»„...");const t=u.topChineseWordsList;if(!e||0===e.length)return t.innerHTML='\n      <div class="prompt-item">\n        <span class="prompt-text">æš‚æ— æ±‰å­—è¯ç»„æ•°æ®</span>\n        <span class="prompt-count">0 æ¬¡</span>\n      </div>\n    ',void console.log("[Main] æ²¡æœ‰æ±‰å­—è¯ç»„æ•°æ®");console.log(`[Main] å…±æœ‰ ${e.length} ä¸ªæ±‰å­—è¯ç»„`),e.forEach((e,t)=>{console.log(`  #${t+1} "${e.word}" ${e.count} æ¬¡`)}),t.innerHTML=e.map((e,t)=>`\n    <div class="prompt-item">\n      <span class="prompt-rank">#${t+1}</span>\n      <span class="prompt-text">${x(e.word)}</span>\n      <span class="prompt-count">${e.count} æ¬¡</span>\n    </div>\n  `).join(""),console.log("[Main] âœ… æ±‰å­—è¯ç»„æ¸²æŸ“å®Œæˆ")}(t.topChineseWordsList),console.log("[Main] âœ… ç»Ÿè®¡ä¿¡æ¯æ˜¾ç¤ºå®Œæˆ")}catch(r){throw console.error("[Main] âŒ æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯å¤±è´¥:",r),r}}(),b(l)}catch(r){console.error("[Main] å¤„ç†å¤±è´¥:",r),n=r.message,console.error("[Main] ä¸Šä¼ é”™è¯¯:",n),c.uploadError.textContent=n,c.uploadError.classList.remove("hidden"),c.loadingSection.classList.add("hidden")}finally{e.target.value=""}var n}else console.warn("[Main] æ²¡æœ‰é€‰æ‹©æ–‡ä»¶")}function m(e,t){e.totalConversations+=t.totalConversations,e.totalCodeChars+=t.totalCodeChars,e.userMessages+=t.userMessages,e.aiMessages+=t.aiMessages,e.qingCount=(e.qingCount||0)+(t.qingCount||0),e.buCount=(e.buCount||0)+(t.buCount||0);for(const[o,s]of Object.entries(t.modelUsage))e.modelUsage[o]=(e.modelUsage[o]||0)+s;for(let o=0;o<24;o++)e.hourlyActivity[o]+=t.hourlyActivity[o];for(const[o,s]of Object.entries(t.dailyActivity))e.dailyActivity[o]=(e.dailyActivity[o]||0)+s;for(const[o,s]of Object.entries(t.topPrompts))e.topPrompts[o]=(e.topPrompts[o]||0)+s;for(const[o,s]of Object.entries(t.topChineseWords||{}))e.topChineseWords=e.topChineseWords||{},e.topChineseWords[o]=(e.topChineseWords[o]||0)+s}function p(e,t){const o=`å·²å¤„ç† ${e}/${t} ä¸ªæ–‡ä»¶`;c.loadingProgress.textContent=o,console.log(`[Main] ${o}`)}function f(e){return e>=1e4?(e/1e4).toFixed(1)+"ä¸‡":e.toLocaleString()}function C(e,t=10){const o=Object.entries(e||{});return 0===o.length?[]:o.sort((e,t)=>t[1]-e[1]).slice(0,t).map(([e,t])=>({word:e,count:t}))}function b(e){console.log(`[Main] æ¸²æŸ“å¯¹è¯åˆ—è¡¨ï¼Œå…± ${e.length} æ¡è®°å½•`);const t=c.chatList,o=e.slice(0,100);if(console.log(`[Main] æ˜¾ç¤ºå‰ ${o.length} æ¡è®°å½•`),0!==o.length)try{t.innerHTML=o.map((e,t)=>{if(!e)return console.warn(`[Main] item ${t} ä¸º nullï¼Œè·³è¿‡`),"";const o=e.text||"",s=e.role||"AI",n=e.timestamp||(new Date).toISOString();return 0===o.length?(console.warn(`[Main] item ${t} çš„æ–‡æœ¬ä¸ºç©ºï¼Œè·³è¿‡`),""):`\n        <div class="chat-item">\n          <div class="chat-item-header">\n            <span class="chat-role ${"USER"===s?"role-user":"role-ai"}">\n              ${"USER"===s?"ğŸ‘¤":"ğŸ¤–"} ${s}\n            </span>\n            <span class="chat-time">${function(e){const t=new Date(e);return t.toLocaleString("zh-CN",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}(n)}</span>\n          </div>\n          <div class="chat-item-content">\n            <p>${x(o.substring(0,200))}${o.length>200?"...":""}</p>\n          </div>\n        </div>\n      `}).join(""),o.length<e.length&&(t.innerHTML+=`\n        <div class="chat-item-more">\n          è¿˜æœ‰ ${e.length-o.length} æ¡å¯¹è¯è®°å½•æœªæ˜¾ç¤º\n        </div>\n      `),console.log("[Main] âœ… å¯¹è¯åˆ—è¡¨æ¸²æŸ“å®Œæˆ")}catch(s){console.error("[Main] âŒ æ¸²æŸ“å¯¹è¯åˆ—è¡¨å¤±è´¥:",s),t.innerHTML=`\n      <div class="chat-item-more">\n        å¯¹è¯åˆ—è¡¨åŠ è½½å¤±è´¥ï¼š${s.message}\n      </div>\n    `}else t.innerHTML='\n      <div class="chat-item-more">\n        æš‚æ— å¯¹è¯è®°å½•\n      </div>\n    '}function y(e){const t=e.target.value.trim();if(!t)return void b(l);b(l.filter(e=>e.text.toLowerCase().includes(t.toLowerCase())))}async function M(){const e=c.exportArea;try{const t=c.exportBtn.innerHTML;c.exportBtn.innerHTML='<span class="btn-icon">â³</span><span>ç”Ÿæˆä¸­...</span>',c.exportBtn.disabled=!0;const o=await s(e,{backgroundColor:"#ffffff",scale:2,useCORS:!0,logging:!1}),n=document.createElement("a");n.download=`cursor-audit-${(new Date).getTime()}.png`,n.href=o.toDataURL("image/png"),n.click(),c.exportBtn.innerHTML=t,c.exportBtn.disabled=!1,console.log("[Main] å¯¼å‡ºæˆåŠŸ")}catch(t){console.error("[Main] å¯¼å‡ºå¤±è´¥:",t),alert("å¯¼å‡ºå¤±è´¥: "+t.message),c.exportBtn.innerHTML='<span class="btn-icon">ğŸ“Š</span><span>ä¿å­˜åˆ†ææŠ¥å‘Š</span>',c.exportBtn.disabled=!1}}function x(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{console.log("[Main] DOMContentLoaded äº‹ä»¶è§¦å‘"),d()}):(console.log("[Main] DOM å·²åŠ è½½ï¼Œç›´æ¥åˆå§‹åŒ–"),d());
